#!/bin/bash

if [ $# -gt 1 ]; then
  echo "Error: Invalid number of arguments."
  echo "Usage: ./sam_dos.sh [<num_processes>]"
  exit 1
fi

if [ $# -eq 1 ] && ! [[ "$1" =~ ^[1-9][0-9]*$ ]]; then
  echo "Error: Invalid argument. Must be a positive integer."
  exit 1
fi

if [ $# -eq 0 ]; then
  num_processes=1
else
  num_processes=$1
fi

start_processes() {
	for i in $(seq 1 $num_processes); do
	    python sam_dos_node.py &
	    echo "Started node ($i)"
	done
}

# Define function to stop processes
stop_processes() {
	echo "Stopping processes..."
	pkill -f "python sam_dos_node.py"
	exit 0
}

# Start processes
start_processes

# Wait for stop signal
trap 'stop_processes' SIGINT SIGTERM

# Wait for processes to finish
wait

